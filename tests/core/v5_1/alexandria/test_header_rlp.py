from eth_utils import decode_hex
import pytest
import rlp

from ddht.v5_1.alexandria.rlp_sedes import BlockHeader

GENESIS = decode_hex(
    "f90214a000000000000000000000000000000000000000000000000000000000"
    "00000000a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142"
    "fd40d49347940000000000000000000000000000000000000000a0d7f8974fb5"
    "ac78d9ac099b9ad5018bedc2ce0a72dad1827a1709da30580f0544a056e81f17"
    "1bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f"
    "171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b90100"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "850400000000808213888080a011bbe8db4e347b4e8c937c1c8370e4b5ed33ad"
    "b3db69cbdb7a38e1e50b1b82faa0000000000000000000000000000000000000"
    "0000000000000000000000000000880000000000000042"
)
HEADER_1 = decode_hex(
    "f90211a0d4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0d"
    "b1cb8fa3a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142"
    "fd40d493479405a56e2d52c817161883f50c441c3228cfe54d9fa0d67e4d4503"
    "43046425ae4271474353857ab860dbc0a1dde64b41b5cd3a532bf3a056e81f17"
    "1bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f"
    "171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b90100"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "8503ff80000001821388808455ba422499476574682f76312e302e302f6c696e"
    "75782f676f312e342e32a0969b900de27b6ac6a67742365dd65f55a0526c41fd"
    "18e1b16f1a1215c2e66f5988539bd4979fef1ec4"
)


@pytest.mark.parametrize(
    "rlp_bytes,block_number,block_hash",
    (
        (
            GENESIS,
            0,
            decode_hex(
                "0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3"
            ),
        ),
        (
            HEADER_1,
            1,
            decode_hex(
                "0x88e96d4537bea4d9c05d12549907b32561d3bf31f45aae734cdc119f13406cb6"
            ),
        ),
    ),
)
def test_block_header_rlp(rlp_bytes, block_number, block_hash):
    header = rlp.decode(rlp_bytes, sedes=BlockHeader)
    assert header.block_number == block_number
    assert header.hash == block_hash
